<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIé”Œé”­å‡ºå…¥ç»Ÿè®¡</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); min-height: 100vh; padding: 0; margin: 0; }
        .main-wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: white; box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        .sidebar-header { padding: 30px 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .sidebar-header h2 { font-size: 20px; margin-bottom: 5px; }
        .sidebar-header p { font-size: 13px; opacity: 0.9; }
        .sidebar-menu { flex: 1; padding: 20px 0; }
        .menu-item { padding: 15px 25px; color: #555; cursor: pointer; transition: all 0.3s ease; border-left: 4px solid transparent; display: flex; align-items: center; gap: 12px; font-size: 15px; }
        .menu-item:hover { background-color: #f5f9ff; color: #4facfe; }
        .menu-item.active { background-color: #e8f4ff; color: #4facfe; border-left-color: #4facfe; font-weight: 600; }
        .sub-menu { padding-left: 20px; background-color: #f8f9fa; }
        .sub-menu .menu-item { padding: 12px 25px; font-size: 14px; }
        .sub-menu .menu-item.active { background-color: #e8f4ff; }
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .container { max-width: 100%; margin: 0; padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .header { background: white; border-radius: 10px; padding: 12px 20px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #333; font-size: 22px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-name { color: #666; font-size: 14px; }
        .logout-btn { padding: 8px 16px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s ease; }
        .logout-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4); }
        .content { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); flex: 1; overflow-y: auto; }
        .statistics-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .statistics-section h3 { color: #333; font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .statistics-controls { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .statistics-controls label { color: #555; font-weight: 500; font-size: 13px; }
        .statistics-controls select { padding: 6px 12px; border: 1px solid #e0e0e0; border-radius: 5px; font-size: 13px; transition: all 0.3s ease; outline: none; cursor: pointer; }
        .statistics-controls select:focus { border-color: #4facfe; box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1); }
        .statistics-result { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .stat-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); }
        .stat-box.inbound-quantity { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-box.inbound-weight { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-box.outbound-quantity { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-box.outbound-weight { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .stat-box.remaining-quantity { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-box.remaining-weight { background: linear-gradient(135deg, #f857a6 0%, #ff5858 100%); }
        .stat-box h4 { font-size: 13px; opacity: 0.9; margin-bottom: 8px; }
        .stat-box p { font-size: 28px; font-weight: 700; margin: 0; }
        .stat-box .unit { font-size: 16px; font-weight: 400; margin-left: 4px; }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- å·¦ä¾§èœå•æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>é”Œé”­åº“ç®¡ç†ç³»ç»Ÿ</h2>
                <p>Zinc Ingot Management</p>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item" onclick="toggleSubMenu()" style="cursor: pointer;">
                    <span>GIé”Œé”­ç®¡ç†</span>
                    <span id="giArrow" style="margin-left: auto;">â–¼</span>
                </div>
                <div class="sub-menu" id="giSubMenu">
                    <div class="menu-item" onclick="window.location.href='gi_inbound.html'">
                        <span>å…¥åº“ç®¡ç†</span>
                    </div>
                    <div class="menu-item" onclick="window.location.href='dashboard.html?menu=gi'">
                        <span>å‡ºåº“ç®¡ç†</span>
                    </div>
                    <div class="menu-item active">
                        <span>å‡ºå…¥ç»Ÿè®¡</span>
                    </div>
                </div>
                <div class="menu-item" onclick="window.location.href='dashboard.html?menu=aluminum'">
                    <span>é«˜é“é”Œé”­ç®¡ç†</span>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="container">
                <div class="header">
                    <h1>GIé”Œé”­å‡ºå…¥ç»Ÿè®¡</h1>
                    <div class="user-info">
                        <span class="user-name">æ¬¢è¿ï¼Œ<strong id="currentUser">ç”¨æˆ·</strong></span>
                        <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
                    </div>
                </div>

                <div class="content">
                    <!-- å…¥åº“ç»Ÿè®¡ -->
                    <div class="statistics-section">
                        <h3>ğŸ“¥ å…¥åº“ç»Ÿè®¡</h3>
                        <div class="statistics-controls">
                            <label for="inboundYear">å¹´ä»½ï¼š</label>
                            <select id="inboundYear" onchange="updateInboundStatistics()"><option value="">å…¨éƒ¨</option></select>
                            <label for="inboundMonth">æœˆä»½ï¼š</label>
                            <select id="inboundMonth" onchange="updateInboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                            </select>
                            <label for="inboundTeam">ç­ç»„ï¼š</label>
                            <select id="inboundTeam" onchange="updateInboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="ç”²">ç”²</option><option value="ä¹™">ä¹™</option>
                                <option value="ä¸™">ä¸™</option><option value="ä¸">ä¸</option>
                            </select>
                            <label for="inboundZincType">é”Œé”­ç§ç±»ï¼š</label>
                            <select id="inboundZincType" onchange="updateInboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="A">A</option><option value="B">B</option>
                                <option value="D">D</option><option value="E">E</option>
                            </select>
                        </div>
                        <div class="statistics-result">
                            <div class="stat-box inbound-quantity"><h4>å…¥åº“æ•°é‡</h4><p id="inboundQuantity">0<span class="unit">ä¸ª</span></p></div>
                            <div class="stat-box inbound-weight"><h4>å…¥åº“é‡é‡</h4><p id="inboundWeight">0<span class="unit">KG</span></p></div>
                        </div>
                    </div>

                    <!-- å‡ºåº“ç»Ÿè®¡ -->
                    <div class="statistics-section">
                        <h3>ğŸ“¤ å‡ºåº“ç»Ÿè®¡</h3>
                        <div class="statistics-controls">
                            <label for="outboundYear">å¹´ä»½ï¼š</label>
                            <select id="outboundYear" onchange="updateOutboundStatistics()"><option value="">å…¨éƒ¨</option></select>
                            <label for="outboundMonth">æœˆä»½ï¼š</label>
                            <select id="outboundMonth" onchange="updateOutboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="1">1æœˆ</option><option value="2">2æœˆ</option><option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option><option value="5">5æœˆ</option><option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option><option value="8">8æœˆ</option><option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option><option value="11">11æœˆ</option><option value="12">12æœˆ</option>
                            </select>
                            <label for="outboundTeam">ç­ç»„ï¼š</label>
                            <select id="outboundTeam" onchange="updateOutboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="ç”²">ç”²</option><option value="ä¹™">ä¹™</option>
                                <option value="ä¸™">ä¸™</option><option value="ä¸">ä¸</option>
                            </select>
                            <label for="outboundZincType">é”Œé”­ç§ç±»ï¼š</label>
                            <select id="outboundZincType" onchange="updateOutboundStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="A">A</option><option value="B">B</option>
                                <option value="D">D</option><option value="E">E</option>
                            </select>
                        </div>
                        <div class="statistics-result">
                            <div class="stat-box outbound-quantity"><h4>å‡ºåº“æ•°é‡</h4><p id="outboundQuantity">0<span class="unit">ä¸ª</span></p></div>
                            <div class="stat-box outbound-weight"><h4>å‡ºåº“é‡é‡</h4><p id="outboundWeight">0<span class="unit">KG</span></p></div>
                        </div>
                    </div>

                    <!-- å½“å‰åº“å­˜ç»Ÿè®¡ -->
                    <div class="statistics-section">
                        <h3>ğŸ“¦ å½“å‰åº“å­˜</h3>
                        <div class="statistics-controls">
                            <label for="remainingZincType">é”Œé”­ç§ç±»ï¼š</label>
                            <select id="remainingZincType" onchange="updateRemainingStatistics()">
                                <option value="">å…¨éƒ¨</option>
                                <option value="A">A</option><option value="B">B</option>
                                <option value="D">D</option><option value="E">E</option>
                            </select>
                        </div>
                        <div class="statistics-result">
                            <div class="stat-box remaining-quantity"><h4>å‰©ä½™æ•°é‡</h4><p id="remainingQuantity">0<span class="unit">ä¸ª</span></p></div>
                            <div class="stat-box remaining-weight"><h4>å‰©ä½™é‡é‡</h4><p id="remainingWeight">0<span class="unit">KG</span></p></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€å˜é‡ ==========
        let inboundItems = [];
        let outboundItems = [];

        // ========== é¡µé¢åŠ è½½åˆå§‹åŒ– ==========
        window.onload = function() {
            checkLogin();
            loadData();
            initializeYearOptions();
            updateInboundStatistics();
            updateOutboundStatistics();
            updateRemainingStatistics();
        };

        function checkLogin() {
            const currentUser = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
            if (!currentUser) { alert('è¯·å…ˆç™»å½•ï¼'); window.location.href = 'login.html'; return; }
            const user = JSON.parse(currentUser);
            document.getElementById('currentUser').textContent = user.username;
        }

        function toggleSubMenu() {
            const subMenu = document.getElementById('giSubMenu');
            const arrow = document.getElementById('giArrow');
            if (subMenu.style.display === 'none') { subMenu.style.display = 'block'; arrow.textContent = 'â–¼'; }
            else { subMenu.style.display = 'none'; arrow.textContent = 'â–¶'; }
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                sessionStorage.removeItem('currentUser');
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // ========== æ•°æ®åŠ è½½ ==========
        function loadData() {
            const savedInbound = localStorage.getItem('items_gi_inbound');
            const savedOutbound = localStorage.getItem('items_gi');
            inboundItems = savedInbound ? JSON.parse(savedInbound) : [];
            outboundItems = savedOutbound ? JSON.parse(savedOutbound) : [];
        }

        // ========== åˆå§‹åŒ–å¹´ä»½é€‰é¡¹ ==========
        function initializeYearOptions() {
            const currentYear = new Date().getFullYear();
            const inboundYearSelect = document.getElementById('inboundYear');
            const outboundYearSelect = document.getElementById('outboundYear');
            
            for (let year = currentYear; year >= currentYear - 10; year--) {
                const option1 = document.createElement('option');
                option1.value = year;
                option1.textContent = year + 'å¹´';
                inboundYearSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = year;
                option2.textContent = year + 'å¹´';
                outboundYearSelect.appendChild(option2);
            }
            
            inboundYearSelect.value = currentYear;
            outboundYearSelect.value = currentYear;
        }

        // ========== å…¥åº“ç»Ÿè®¡ ==========
        function updateInboundStatistics() {
            const selectedYear = document.getElementById('inboundYear').value;
            const selectedMonth = document.getElementById('inboundMonth').value;
            const selectedTeam = document.getElementById('inboundTeam').value;
            const selectedZincType = document.getElementById('inboundZincType').value;
            
            let totalQuantity = 0, totalWeight = 0;
            inboundItems.forEach(item => {
                let dateMatch = true;
                if (item.D) {
                    const itemDate = new Date(item.D);
                    dateMatch = (!selectedYear || itemDate.getFullYear() == selectedYear) && 
                               (!selectedMonth || (itemDate.getMonth() + 1) == selectedMonth);
                }
                let teamMatch = !selectedTeam || (item.A && item.A.trim() === selectedTeam);
                let zincTypeMatch = !selectedZincType || item.ZincType === selectedZincType;
                
                if (dateMatch && teamMatch && zincTypeMatch) {
                    totalQuantity += parseInt(item.B) || 0;
                    totalWeight += parseFloat(item.C) || 0;
                }
            });
            
            document.getElementById('inboundQuantity').innerHTML = `${totalQuantity}<span class="unit">ä¸ª</span>`;
            document.getElementById('inboundWeight').innerHTML = `${totalWeight.toFixed(2)}<span class="unit">KG</span>`;
        }

        // ========== å‡ºåº“ç»Ÿè®¡ ==========
        function updateOutboundStatistics() {
            const selectedYear = document.getElementById('outboundYear').value;
            const selectedMonth = document.getElementById('outboundMonth').value;
            const selectedTeam = document.getElementById('outboundTeam').value;
            const selectedZincType = document.getElementById('outboundZincType').value;
            
            let totalQuantity = 0, totalWeight = 0;
            outboundItems.forEach(item => {
                let dateMatch = true;
                if (item.D) {
                    const itemDate = new Date(item.D);
                    dateMatch = (!selectedYear || itemDate.getFullYear() == selectedYear) && 
                               (!selectedMonth || (itemDate.getMonth() + 1) == selectedMonth);
                }
                let teamMatch = !selectedTeam || (item.A && item.A.trim() === selectedTeam);
                let zincTypeMatch = !selectedZincType || item.ZincType === selectedZincType;
                
                if (dateMatch && teamMatch && zincTypeMatch) {
                    totalQuantity += parseInt(item.B) || 0;
                    totalWeight += parseFloat(item.C) || 0;
                }
            });
            
            document.getElementById('outboundQuantity').innerHTML = `${totalQuantity}<span class="unit">ä¸ª</span>`;
            document.getElementById('outboundWeight').innerHTML = `${totalWeight.toFixed(2)}<span class="unit">KG</span>`;
        }

        // ========== å½“å‰åº“å­˜ç»Ÿè®¡ ==========
        function updateRemainingStatistics() {
            const selectedZincType = document.getElementById('remainingZincType').value;
            
            let inboundQuantity = 0, inboundWeight = 0;
            inboundItems.forEach(item => {
                let typeMatch = !selectedZincType || item.ZincType === selectedZincType;
                if (typeMatch) {
                    inboundQuantity += parseInt(item.B) || 0;
                    inboundWeight += parseFloat(item.C) || 0;
                }
            });
            
            let outboundQuantity = 0, outboundWeight = 0;
            outboundItems.forEach(item => {
                let typeMatch = !selectedZincType || item.ZincType === selectedZincType;
                if (typeMatch) {
                    outboundQuantity += parseInt(item.B) || 0;
                    outboundWeight += parseFloat(item.C) || 0;
                }
            });
            
            const remainingQuantity = inboundQuantity - outboundQuantity;
            const remainingWeight = inboundWeight - outboundWeight;
            
            document.getElementById('remainingQuantity').innerHTML = `${remainingQuantity}<span class="unit">ä¸ª</span>`;
            document.getElementById('remainingWeight').innerHTML = `${remainingWeight.toFixed(2)}<span class="unit">KG</span>`;
        }
    </script>
</body>
</html>

